
<!-- Hide Safari Browser bar on iOS -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<link href="assets/favicon.png" sizes="72x72" rel="apple-touch-icon">
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>

<!-- Preloader -->
<div id="preloader">
  <div id="status">&nbsp;</div>
</div>
	
	<div class='row'>
		<div class='small-6 large-offset-3 columns'>
			<%= render "shared/share_modal", url: project_url(@project) %>
	</div>

	<div class='row'>
		<div class='small-8 large-offset-2 columns'>
			<div id="myModal" class="reveal-modal" data-reveal>
			  <h2>Embed your presentation:</h2>

			  <%= form_for "#" do |f| %>
				  <%= f.text_field '', :value => "<iframe src='" + project_url(@project) + "' height='100%' width='100%' seamless='seamless'></iframe>", disabled: true %>
				<% end %>
			  <a class="close-reveal-modal">&#215;</a>
			</div>
		</div>
	</div>

	<div id="myModal3" class="reveal-modal small" data-reveal>
	  <!-- GOOGLE HANGOUT SCRIPT -->
	  <h2>Screenshare your presentation:</h2>
		<script type="text/javascript" src="https://apis.google.com/js/platform.js"></script>
			<div class="g-hangout" data-render="createhangout"></div>
	  <a class="close-reveal-modal">&#215;</a>
	</div>

	<div class="controls">
		<div class="vertical-menu">

			<a href="#" data-reveal-id="myModal"><i class='entypo-code'></i></a>
	<!-- 	<%= link_to "<i class='icon-download'></i>".html_safe, project_path(@project, :format => "pdf") %> -->
			<a href="#" data-reveal-id="share_modal"><i class='entypo-share'></i></a>
				<a href="#" data-reveal-id="myModal3"><i class='entypo-mic'></i></a>
			<!-- <a href="#" class="slider"><i class='icon-th'></i></a> -->

		</div>

		<div class='top-left'>
			<% if current_user.present? %>
				<i class='entypo-left'></i>
			<% end %>
		</div>

		<div class='player'>
			<i class='entypo-left-open-big target'></i>
			<i class='entypo-right-open-big'></i>
			<div class="expand"></div>
		</div>
	</div>




		<script>
			$(function(){
				$("#pt-main").on('dragstart', function(event) { event.preventDefault(); });

				$( "#pt-main" ).on( "swipeleft", swipeleftHandler );
	 			
			  // Callback function references the event target and adds the 'swipeleft' class to it
			  function swipeleftHandler( event ){
			  	$(".icon-chevron-right").click();
			   
			 	}
			});

			$(function(){
			  $( "#pt-main" ).on( "swiperight", swiperightHandler );
			 
			  // Callback function references the event target and adds the 'swipeleft' class to it
			  function swiperightHandler( event ){
			    $(".icon-chevron-left").click();
			  }
			});

		</script>

<!-- 		Slide Navigator -->
		<!-- <div id="wrapper">
		  <div id="scroller">
		    <ul>
					<% @project.slides.order("position").each do |slide| %>
					 	<li class="slide-nav">
							<% if slide.mimetype == "video/mp4" %>
								<video width='101px' height='57px'>
									<source src="<%= slide.filepicker_url %>">
								</video>
							<% else %>
								<img src="<%= slide.filepicker_url %>">
							<% end %>
						</li>
					<% end %>					 
				</ul>
			</div>
		</div> -->

		<!-- <canvas id="myChart" width="50" height="50">
		</canvas> -->


		<div id="pt-main" style="display:none;" class="pt-perspective">
			<% @project.slides.order("position").to_enum.with_index(1).each do |slide, index| %>
				<div class="pt-page" data-transition="<%= @project.transition %>">

					<!-- Slide Numbers -->
				<!--   <div id='slide-number' data-slidenumber='<%= index %>' data-slidecount='<%= @project.slides.count %>'><%= index %></div> -->
				  
  				
					<% if slide.mimetype == "video/mp4" %>
						<video width='100%' height='100%' autoplay="autoplay">
							<source src="<%= slide.filepicker_url %>">
						</video>
					<% else %>
						<% unless slide.filepicker_url.blank? %>
							<img src="<%= slide.filepicker_url %>">
						<% else %>
							<div class="blank" id="slide-<%= slide.id -%>"></div>

							<% if slide.embed_code =~ /^#{URI::regexp}$/%>
						
								<script>
								$(document).ready(function() {
							    var pop = Popcorn.smart( "#slide-<%= slide.id -%>", "<%= slide.embed_code %>" );
							  
							     var playing = false;
							     $( "body" ).on( "change-slide", function() {
							    
							     	if($("#slide-<%= slide.id -%>").parent(".pt-page").hasClass('pt-page-current')) { 
							     		playing = true;
							     	 	pop.play(); //Autoplay on slide reveal.
								     } else {
								     	
								     	if(playing) { //pause and reset current time to 0 if you switch slides.
								     	  pop.pause();
								     	  pop.currentTime(0);
								     	  console.log("paused")
								     	  playing = false;
								     	}
								     }
							     });
							   });
								</script>
							<% end %>
						<% end %>
					<% end %>
				</div>
			<% end %>
		</div>

		<script>
			var slide = document.getElementById('slide-number');
      var slidenumber = slide.getAttribute('data-slidenumber');
      var slidecount = slide.getAttribute('data-slidecount');

			var data = [
				{
					value : slidenumber*360,
					color : "#5f6f81"
				},
				{
					value : slidecount*360 - slidenumber*360,
					color : "#FFF"
				}			
			];

		  var options = {
			//Boolean - Whether we should show a stroke on each segment
			segmentShowStroke : false,
			
			//String - The colour of each segment stroke
			segmentStrokeColor : "#fff",
			
			//Number - The width of each segment stroke
			segmentStrokeWidth : 2,
			
			//The percentage of the chart that we cut out of the middle.
			percentageInnerCutout : 75,
			
			//Boolean - Whether we should animate the chart	
			animation : true,
			
			//Number - Amount of animation steps
			animationSteps : 50,
			
			//String - Animation easing effect
			animationEasing : "easeOutSine",
			
			//Boolean - Whether we animate the rotation of the Doughnut
			animateRotate : true,

			//Boolean - Whether we animate scaling the Doughnut from the centre
			animateScale : false,
			
			//Function - Will fire on animation completion.
			onAnimationComplete : null
			}

			//Get the context of the canvas element we want to select
			var ctx = document.getElementById("myChart").getContext("2d");
			var myNewChart = new Chart(ctx).Doughnut(data, options);

			
		</script>
 		
            <!-- Preloader -->
    <script type="text/javascript">
    //<![CDATA[
      $(window).load(function() { // makes sure the whole site is loaded

				$("#status").fadeOut(); // will first fade out the loading animation
				var opts = {
				lines: 13, // The number of lines to draw
				length: 1, // The length of each line
				width: 5, // The line thickness
				radius: 13, // The radius of the inner circle
				corners: 1, // Corner roundness (0..1)
				rotate: 0, // The rotation offset
				direction: 1, // 1: clockwise, -1: counterclockwise
				color: 'white', // #rgb or #rrggbb or array of colors
				speed: 1, // Rounds per second
				trail: 60, // Afterglow percentage
				shadow: false, // Whether to render a shadow
				hwaccel: false, // Whether to use hardware acceleration
				className: 'spinner', // The CSS class to assign to the spinner
				zIndex: 2e9, // The z-index (defaults to 2000000000)
				top: 'auto', // Top position relative to parent in px
				left: 'auto' // Left position relative to parent in px
				};
				var target = document.getElementById('status');
				var spinner = new Spinner(opts).spin(target);
				$("#preloader").delay(350).fadeOut("slow"); // will fade out the white DIV that covers the website.
				$("#pt-main").fadeIn('slow');
  
      })
    //]]>
    $(".top-bar").hide();
		</script>

		<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>

		<script type="text/javascript">

		var myScroll;

		function loaded () {
		        myScroll = new IScroll('#wrapper', { scrollX: true, scrollY: false, mouseWheel: true, hScrollbar: true, hideScrollbar: false });
		}

		document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);

		</script>






